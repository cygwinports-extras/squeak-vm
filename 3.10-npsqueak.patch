--- origsrc/squeak-3.10/platforms/unix/npsqueak/Makefile	2007-10-15 11:15:33.000000000 -0500
+++ src/squeak-3.10/platforms/unix/npsqueak/Makefile	2012-08-01 17:31:35.207665600 -0500
@@ -8,7 +8,8 @@ INC	= -I./include -I/usr/X11R6/include
 CC	= gcc
 CFLAGS	= $(INC) -O2 -fPIC -Wall
 LD	= gcc
-LDFLAGS = -lXt
+LDFLAGS = -lXt -lX11
+LIBTOOL = ../libtool
 
 # usually overridden from top level makefile
 VM_VERSION=  3.9-12
@@ -22,23 +23,23 @@ npsqueakrun=	npsqueakrun
 
 
 ############ compile and link ###########################
-all: npsqueak.so npsqueakrun
+all: npsqueak.dll npsqueakrun
 
-npsqueak.so : npsqueak.la 
+npsqueak.dll : npsqueak.la 
 	-@rm -f $@ 
-	ln .libs/npsqueak $@ 
+	cp .libs/npsqueak.dll $@ 
 
 npsqueak.la : npsqueak.lo npunix.lo 
-	../libtool --mode=link $(LD) $(LDFLAGS) npsqueak.lo npunix.lo -avoid-version -module -rpath $(plgdir) -o $@
+	$(LIBTOOL) --mode=link $(LD) $(LDFLAGS) npsqueak.lo npunix.lo -avoid-version -module -no-undefined -rpath $(plgdir) -o $@
 
 npsqueak.lo: npsqueak.c ../config.h
-	../libtool --mode=compile $(CC) -c $(CFLAGS) \
+	$(LIBTOOL) --mode=compile $(CC) -c $(CFLAGS) \
 		-DSYSTEM_BIN_DIR=\"$(scriptdir)\" \
 		-DSYSTEM_IMG_DIR=\"$(imgdir)\" \
 		-DNPSQUEAKRUN=\"$(npsqueakrun)\" $<
 
 npunix.lo: npunix.c
-	../libtool --mode=compile $(CC) -c $(CFLAGS) $<
+	$(LIBTOOL) --mode=compile $(CC) -c $(CFLAGS) $<
 
 npsqueakrun: npsqueakrun.in 
 	sed "s|@imgdir@|$(imgdir)|; \
@@ -47,7 +48,7 @@ npsqueakrun: npsqueakrun.in
 	chmod +x $@
 
 npsqueakregister: npsqueakregister.in 
-	sed "s|@NPSQUEAK_SO@|$(plgdir)/npsqueak.so|" \
+	sed "s|@NPSQUEAK_SO@|$(plgdir)/npsqueak.dll|" \
 		npsqueakregister.in > $@
 	chmod +x $@
 
@@ -64,9 +65,8 @@ $(ROOT)$(scriptdir):
 $(ROOT)$(plgdir): 
 	install -d $@
 
-$(ROOT)$(plgdir)/npsqueak.so: npsqueak.so $(ROOT)$(plgdir)
-	cp npsqueak.so $@
-	strip $@
+$(ROOT)$(plgdir)/npsqueak.dll: npsqueak.dll $(ROOT)$(plgdir)
+	cp npsqueak.dll $@
 
 $(ROOT)$(scriptdir)/npsqueakrun: npsqueakrun $(ROOT)$(scriptdir)
 	cp npsqueakrun $@
@@ -78,7 +78,7 @@ $(ROOT)$(imgdir)/npsqueakregister: npsqu
 ### Go! ###
 
 NPSQUEAK_TARGETS=                   \
-	$(ROOT)$(plgdir)/npsqueak.so    \
+	$(ROOT)$(plgdir)/npsqueak.dll    \
 	$(ROOT)$(scriptdir)/npsqueakrun    \
 	$(ROOT)$(scriptdir)/npsqueakregister
 
